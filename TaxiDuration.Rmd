---
title: "Untitled"
author: "Madeline Abbott"
date: "March 1, 2018"
output: html_document
---

Some packages...
```{r}
library(readr)
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(dplyr)
library(survival)
```

## Read in data:
```{r}
Taxi <- read_csv("~/Desktop/Taxi.csv")
```

### A first look at the data:

### Create a histogram of trip durations
```{r}
ggplot(Taxi, aes(trip_duration)) + geom_histogram(fill = "yellow", col = "black", bins = 200) + scale_x_log10()
```

### A map of pick-up locations
```{r}
states <- map_data("state")
ggplot(data = states) + geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + coord_fixed(1.3) + guides(fill=FALSE) + geom_point(data = Taxi, aes(x = pickup_longitude, y = pickup_latitude), color = "black", size = 2, alpha = 0.5) 
```
### A map of drop-off locations
```{r}
ggplot(data = states) + geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + coord_fixed(1.3) + guides(fill=FALSE) + geom_point(data = Taxi, aes(x = dropoff_longitude, y = dropoff_latitude), color = "black", size = 2, alpha = 0.5) 
```


### A map of long trips with duration over 12 hours (43200 seconds)
```{r}
longTaxi <- Taxi %>%
  filter(trip_duration > 43200)

ggplot(data = states) + geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + coord_fixed(1.3) + guides(fill=FALSE) + geom_point(data = longTaxi, aes(x = dropoff_longitude, y = dropoff_latitude), color = "black", size = 2, alpha = 0.5) 
```

### A map of short trips with duration under 30 seconds
```{r}
shortTaxi <- Taxi %>%
  filter(trip_duration < 30)

ggplot(data = states) + geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + coord_fixed(1.3) + guides(fill=FALSE) + geom_point(data = shortTaxi, aes(x = dropoff_longitude, y = dropoff_latitude), color = "black", size = 2, alpha = 0.5) 
```



## Things to do:

* remove pick-up and drop-off locations that are far away
* remove trips with extra long durations
* remove trips with really short (like 10 second) durations


## Data Cleaning:
```{r}
# so far this limits longitude to between -80 and -70 degrees, and latitude to between 37 and 43 degrees,
# and restricts duration to under 80000 seconds (about 22 hours)
cleanTaxi <- Taxi %>%
  filter(-70 > pickup_longitude && pickup_longitude > -80 && 37 < pickup_latitude && pickup_latitude < 43) %>%
  filter(-70 > dropoff_longitude && dropoff_longitude > -80 && 37 < dropoff_latitude && dropoff_latitude < 43) %>%
  filter(trip_duration < 80000)
cleanTaxi$trip_duration <- as.double(cleanTaxi$trip_duration)
```





## Preliminary Analysis:


### Plot trip duration with a Kaplan-Meier curve
```{r}
KM_taxi <- survfit(Surv(trip_duration) ~ 1, data = cleanTaxi)
plot(KM_taxi, col = 'purple', xlim = c(0, 20000))
```












